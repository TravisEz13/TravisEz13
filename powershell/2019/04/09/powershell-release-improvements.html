<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>PowerShell Core Release Improvements | TravisEz13</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="PowerShell Core Release Improvements" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="PowerShell Core Release Improvements" />
<meta property="og:description" content="PowerShell Core Release Improvements" />
<link rel="canonical" href="https://travis.ez13.net/powershell/2019/04/09/powershell-release-improvements.html" />
<meta property="og:url" content="https://travis.ez13.net/powershell/2019/04/09/powershell-release-improvements.html" />
<meta property="og:site_name" content="TravisEz13" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-09T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2019-04-09T00:00:00-05:00","url":"https://travis.ez13.net/powershell/2019/04/09/powershell-release-improvements.html","@type":"BlogPosting","dateModified":"2019-04-09T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://travis.ez13.net/powershell/2019/04/09/powershell-release-improvements.html"},"headline":"PowerShell Core Release Improvements","description":"PowerShell Core Release Improvements","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://travis.ez13.net/feed.xml" title="TravisEz13" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">TravisEz13</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/disclaimer/">Work Disclaimer</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">PowerShell Core Release Improvements</h1><p class="page-description">PowerShell Core Release Improvements</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-04-09T00:00:00-05:00" itemprop="datePublished">
        Apr 9, 2019
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#PowerShell">PowerShell</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#overview">Overview</a></li>
<li class="toc-entry toc-h2"><a href="#current-state">Current state</a></li>
<li class="toc-entry toc-h2"><a href="#goals">Goals</a></li>
<li class="toc-entry toc-h2"><a href="#what-we-have-done-so-far">What we have done so far</a>
<ul>
<li class="toc-entry toc-h3"><a href="#summary-of-improvements">Summary of improvements</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#details-of-the-combined-build">Details of the combined build</a></li>
<li class="toc-entry toc-h2"><a href="#what-is-left-to-do">What is left to do</a></li>
</ul><h2 id="overview">
<a class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>For <a href="https://github.com/powershell/powershell">PowerShell Core</a>, we basically had to build a new engineering system to build and release it.  How we build it has evolved over time as we learn and our other teams have implemented features that make some tasks easier.  We are finally at a state that we believe we can engineer a system that builds PowerShell Core for release with as little human interaction as necessary.</p>

<h2 id="current-state">
<a class="anchor" href="#current-state" aria-hidden="true"><span class="octicon octicon-link"></span></a>Current state</h2>

<p>Before the changes described here, we had one build per platform.  After the binaries were built, they had to be tested and then packaged into the various packages for release.  This is done in a private <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops">Azure DevOps Pipelines</a> instance.  In this state, it took a good deal of people’s time to do a PowerShell Core release.  Before these changes, it would take 3-4 people about a week to release PowerShell Core.  During this time, the percentage of time people were focused on the release probably averaged 50%.</p>

<h2 id="goals">
<a class="anchor" href="#goals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Goals</h2>

<ol>
  <li>Remain compliant with Microsoft and external standards we are required to follow.</li>
  <li>Automate as much of the build, test, and release process as possible.
    <ul>
      <li>This should significantly reduce the amount of human toil needed in each release.</li>
    </ul>
  </li>
  <li>Hopefully, provide some tools or practices others can follow.</li>
</ol>

<h2 id="what-we-have-done-so-far">
<a class="anchor" href="#what-we-have-done-so-far" aria-hidden="true"><span class="octicon octicon-link"></span></a>What we have done so far</h2>

<ol>
  <li>We ported our <a href="https://en.wikipedia.org/wiki/Continuous_integration">CI</a> tests to Azure DevOps Pipelines.
    <ul>
      <li>We have used this in a release and we see that this allowed us to run at least those test in our private Azure DevOps Pipelines instance.</li>
      <li>This saves us 2-4 man hours per release and a day or more of calendar time if all goes well.</li>
    </ul>
  </li>
  <li>We have moved our release build definitions to <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema#job-templates">YAML</a>.
    <ul>
      <li>We have used this in a release and we see that this allows us to treat the release build as code and iterate more quickly.</li>
      <li>This saves us 1-2 man hours per release, when we have done everything correctly.</li>
    </ul>
  </li>
  <li>I have begun to merge the the different platform builds into one combined build.
    <ul>
      <li>We have not yet used this in a release but we believe this should allow us to have a single button that gets us ready to test.</li>
      <li>This has not been in use long enough to determine how much time it will save.</li>
    </ul>
  </li>
  <li>We have begun to automate our releases testing.  Our release testing is very similar to our CI testing just across more distributions and versions of  Windows.  We plan to be able to run this through Azure DevOps Pipelines as well.
    <ul>
      <li>This has not been in use long enough to determine how much time it will save.</li>
    </ul>
  </li>
  <li>We have automated the generation of the draft of the change log and categorizing the entries based on labels the maintainers apply to the PRs.  After generation, the maintainers still need to review the change descriptions to make sure it makes sense in the change log.
    <ul>
      <li>This saves us 2-4 man hours per release.</li>
    </ul>
  </li>
</ol>

<h3 id="summary-of-improvements">
<a class="anchor" href="#summary-of-improvements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary of improvements</h3>

<p>After all these changes, we can now release with 2-3 people in 2 to 3 days, with an average of 25% time focusing on the release.</p>

<h2 id="details-of-the-combined-build">
<a class="anchor" href="#details-of-the-combined-build" aria-hidden="true"><span class="octicon octicon-link"></span></a>Details of the combined build</h2>

<p>Azure DevOps Pipelines allows us to define complex build pipeline.  The build will be complex but things like <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops">templates in Azure DevOps</a> makes breaking it into a manageable pieces.</p>

<p>Although this design does not technically reduce the number of parts, one significant thing it does for us it put all of our <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/artifacts/artifacts-overview?view=azure-devops">artifacts</a>, in one place.  Having the artifacts in one place, reduces the input to the steps in the rest of the build such as test and release.</p>

<p>I’m not going to discuss it much, but in order to coordinate this work we are keeping diagram of the build.  I’ll include it here.  If you want me to post another blog on the details, please leave a comment.</p>

<p><img src="https://raw.githubusercontent.com/PowerShell/PowerShell/master/tools/releaseBuild/azureDevOps/diagram.svg?sanitize=true" alt="diagram"></p>

<h2 id="what-is-left-to-do">
<a class="anchor" href="#what-is-left-to-do" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is left to do</h2>

<ol>
  <li>We still have to add the other various NuGet package build steps to the coordinated build.</li>
  <li>We need to automate functionality (CI tests) across a representative sample of supported platforms.</li>
  <li>It would be nice if we could enforce in GitHub the process that helps us automate the change log generation.</li>
  <li>We need to automate the release process including:
    <ul>
      <li>Automating package testing.  For example, MSI, Zip, Deb, RPM, and Snap.</li>
      <li>Automating the actual release to GitHub, mcr.microsoft.com, packages.microsoft.com and the Snap store.</li>
    </ul>
  </li>
</ol>

  </div><a class="u-url" href="/powershell/2019/04/09/powershell-release-improvements.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Travis&#39; Blog</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/TravisEz13" title="TravisEz13"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://stackoverflow.com/users/2658816" title="2658816"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use></svg></a></li><li><a rel="me" href="https://twitter.com/TravisPlunk" title="TravisPlunk"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a rel="me" href="https://t.me/TravisEz13" title="TravisEz13"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#telegram"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
